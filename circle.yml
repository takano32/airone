
## test machine
machine:
  timezone: Asia/Tokyo
  python:
    version: 3.5.0
  services:
    - rabbitmq-server
    - memcached

## dependencies
dependencies:
  override:
    - pip install tox tox-pyenv coverage
    - cd /opt/circleci/.pyenv && git pull
    - |
      if [[ ! -d /opt/circleci/python/3.6.1 ]]; then
        pyenv install 3.6.1
      fi
    - cd ~ && pyenv local 2.7.10 3.4.3 3.5.0 3.6.1 system
  cache_directories:
    - /opt/circleci/python/3.6.1
    - elasticsearch-6.2.3
  post:
    - if [[ ! -e elasticsearch-6.2.3 ]]; then wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.3.tar.gz && tar -xvf elasticsearch-6.2.3.tar.gz; fi
    - elasticsearch-6.2.3/bin/elasticsearch: {background: true}

## test definition
test:
  override:
    - tox
  post:
    - ./coverage.sh
