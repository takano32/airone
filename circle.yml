
## test machine
machine:
  timezone: Asia/Tokyo
  python:
    version: 3.5.0
  services:
    - rabbitmq-server
    - memcached
    - elasticsearch

## dependencies
dependencies:
  override:
    - pip install tox tox-pyenv coverage
    - cd /opt/circleci/.pyenv && git pull
    - |
      if [[ ! -d /opt/circleci/python/3.6.1 ]]; then
        pyenv install 3.6.1
      fi
    - cd ~ && pyenv local 2.7.10 3.4.3 3.5.0 3.6.1 system
  cache_directories:
    - /opt/circleci/python/3.6.1

## test definition
test:
  override:
    - tox
  post:
    - ./coverage.sh
