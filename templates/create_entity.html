{% extends 'base.html' %}

{% block title %}Create new Entity{% endblock %}

{% block nav_sub_header %}
<div class="conatiner-fluid">
  <ul class="breadcrumb airone-breadcrumb">
    <li class="breadcrumb-item"><a href="/">TOP</a></li>
    <li class="breadcrumb-item"><a href='/entity/'>エンティティ一覧</a></li>
    <li class="breadcrumb-item">新規エンティティ作成</li>
  </ul>
</div>
{% endblock %}

{% block content %}
<form url="/entity/do_create" method="post">
  <div class="container-fluid">
    <div class="row">
      <div class="col">
        <div class="float-right">
          <input name="button_save" type="submit" class="btn btn-primary" value='保存'></input>
        </div>
        <table class="table table-bordered">
          <tr>
            <td>エンティティ名</td>
            <td><input type="text" name="name" /></td>
          </tr>
          <tr>
            <td>備考</td>
            <td><input type="text" name="note" size="50"/></td>
          </tr>
        </table>

        <table class="table table-bordered">
          <thead>
            <th>属性名</th>
            <th>型</th>
            <th>必須</th>
            <th></th>
          </thead>
          <tbody name="attributes" id='sortdata'>
            <tr class="attr">
              <input type='hidden' class="row_index" value='1' />
              <td><input type="text" class="attr_name" /></td>
              <td>
                <select class="attr_type">
                  {% for type in attr_types %}
                  <option value="{{ type.TYPE }}">{{ type.NAME }}</option>
                  {% endfor %}
                </select>
                <select class="attr_referral" style="display:none">
                  {% for entity in entities %}
                  <option value="{{ entity.id }}">{{ entity.name }}</option>
                  {% endfor %}
                </select>
              </td>
              <td>
                {% if attr.is_mandatory %}
                <input type='checkbox' class='is_mandatory' checked='checked'></input>
                {% else %}
                <input type='checkbox' class='is_mandatory'></input>
                {% endif %}
              </td>
              <td>
                <button type="button" class="btn btn-danger btn-sm" name="del_attr">del</button>
              </td>
            </tr>
          </tbody>

          <!-- a template of attribute -->
          <tfoot style="display:none">
            <tr name="attr_template">
              <td><input type='text' class='attr_name'></input></td>
              <td>
                <select class='attr_type'>
                  {% for type in attr_types %}
                  <option value='{{ type.TYPE }}'>{{ type.NAME }}</option>
                  {% endfor %}
                </select>
                <select class='attr_referral' style='display:none'>
                  {% for entity in entities %}
                  <option value='{{ entity.id }}'>{{ entity.name }}</option>
                  {% endfor %}
                </select>
              </td>
              <td>
                {% if attr.is_mandatory %}
                <input type='checkbox' class='is_mandatory' checked='checked'></input>
                {% else %}
                <input type='checkbox' class='is_mandatory'></input>
                {% endif %}
              </td>
              <td>
                <button type="button" class="btn btn-danger btn-sm" name="del_attr">del</button>
              </td>
              <input type='hidden' class="row_index" />
            </tr>
          </tfoot>
        </table>

        <button type="button" name="add_attr">属性追加</button>

      </div>
    </div>
  </div>

  {% csrf_token %}
</form>
{% endblock %}

{% block script %}
<script src="/static/js/entity.js"></script>
{% endblock %}
