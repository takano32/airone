{% extends 'base.html' %}

{% block title %}Edit Entity{% endblock %}

{% block nav_sub_header %}
<div class="conatiner-fluid">
  <ul class="breadcrumb airone-breadcrumb">
    <li class="breadcrumb-item"><a href="/">TOP</a></li>
    <li class="breadcrumb-item"><a href='/entity/'>エンティティ一覧</a></li>
    <li class="breadcrumb-item">{{ entity.name }}</li>
  </ul>
</div>
{% endblock %}

{% block content %}
<form url="/entity/do_edit/{{ entity.id }}" method="post">
  <div class="container-fluid">
    <div class="row">
      <div class="col">
        <div class="float-right">
          <input name="button_save" type="submit" class="btn btn-primary" value='保存'></input>
        </div>
        <table class="table table-bordered">
          <tr>
            <td>エンティティ名</td>
            <td><input type="text" name="name" value="{{ entity.name }}" /></td>
          </tr>
          <tr>
            <td>備考</td>
            <td><input type="text" name="note" size="50" value="{{ entity.note }}" /></td>
          </tr>
        </table>

        <table class="table table-bordered">
          <thead>
            <th>属性名</th>
            <th>型</th>
            <th>必須</th>
            <th></th>
            <th></th>
          </thead>

          <tbody name="attributes" id='sortdata'>
            {% for attr in attributes %}
            <tr class="attr" attr_id="{{ attr.id }}">
              <input type='hidden' class="row_index" value='{{ forloop.counter }}' />
              <td><input type="text" class="attr_name" value="{{ attr.name }}"/></td>
              <td>
                <select class="attr_type">
                  {% for type in attr_types %}
                  <option value="{{ type.TYPE }}" {% if attr.type == type.TYPE %}selected="selected"{% endif %}>{{ type.NAME }}</option>
                  {% endfor %}
                </select>
                
                <select class="attr_referral" {% if not attr.referral %}style="display:none"{% endif %}>
                  {% for entity in entities %}
                  <option value="{{ entity.id }}" {% if attr.referral.id == entity.id %}selected="selected"{% endif %}>{{ entity.name }}</option>
                  {% endfor %}
                </select>

              </td>
              <td>
                {% if attr.is_mandatory %}
                <input type="checkbox" class="is_mandatory" checked="checked" />
                {% else %}
                <input type="checkbox" class="is_mandatory" />
                {% endif %}
              </td>
              <td>
                <a href="/acl/{{ attr.id }}"><button type="button" class="btn btn-info btn-sm">ACL</button></a>
              </td>
              <td>
                <button type="button" class="btn btn-danger btn-sm" name="del_attr">del</button>
              </td>
            </tr>
            {% endfor %}
          </tbody>

          <!-- templates -->
          <tfoot style="display:none">
            <tr name="attr_template">
              <td><input type="text" class="attr_name"></input></td>
              <td>
                <select class="attr_type">
                  {% for type in attr_types %}
                  <option value="{{ type.TYPE }}">{{ type.NAME }}</option>
                  {% endfor %}
                </select>
                <select class="attr_referral" style="display:none">
                  {% for entity in entities %}
                  <option value="{{ entity.id }}">{{ entity.name }}</option>
                  {% endfor %}
                </select>
              </td>
              <td>
                <input type="checkbox" class="is_mandatory"></input>
              </td>
              <td>

              </td>
              <td>
                <button type="button" class="btn btn-danger btn-sm" name="del_attr">del</button>
              </td>
              <input type='hidden' class="row_index" />
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <button type="button" class="btn btn-primary" name="add_attr">属性追加</button>
      </div>
    </div>
  </div>
  {% csrf_token %}
</form>
{% endblock %}

{% block script %}
<script src="/static/js/entity.js"></script>
{% endblock %}
