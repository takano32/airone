{% extends 'base.html' %}

{% block title %}検索結果{% endblock %}

{% block nav_sub_header %}
<div class="conatiner-fluid">
  <ul class="breadcrumb airone-breadcrumb">
    <li class="breadcrumb-item"><a href="/">TOP</a></li>
    <li class="breadcrumb-item">検索結果</li>
  </ul>
</div>
{% endblock %}

{% block content %}
<div class="container-fluid">
  {% if results %}
    <table class="table table-bordered">
      <tr>
        <th>Name</th>
        <th>Note</th>
      </tr>
      {% for result in results %}
      <tr>
        {% if result.type == "Entity" %}
          <td><a href="/entry/{{ result.object.id }}/">{{ result.object.name }}</a></td>
        {% else %}
          <td><a href="/entry/show/{{ result.object.id }}/">{{ result.object.name }}</a></td>
        {% endif %}

        <td>{{ result.hint }}</td>
      </tr>
      {% endfor %}
    </table>
  {% else %}
    該当情報なし
  {% endif %}
</div>
{% endblock %}

{% block script %}
<script>
$(document).ready(function() {
  /* get search query from url */
  let querystr = $(location).attr('search');

  if(!querystr.startsWith("?")) {
    return;
  }

  let qarr = querystr.substring(1).split("&");
  let search_query = "";

  for(let i in qarr) {
    let parr = qarr[i].split("=");
    if(parr[0] == "query") {
      search_query = parr[1];
      break;
    }
  }

  /* set search box default value to current query */
  $('input[name="query"]').val(search_query);

  /* highlight row which entry name is exactly same as search query */
  $('td>a').each(function(idx, val) {
    if($(this).text() == search_query) {
      $(this).parent().parent().addClass("table-primary");
    }
  });
  
});
</script>
{% endblock %}
